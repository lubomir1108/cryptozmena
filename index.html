<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Odkaz pre ƒæudstvo ‚Äî Kapsula ƒåasu v. 9.0 (≈†≈•astn√Ω Slot Edition)</title>
<meta name="description" content="Zanechaj vetu pre bud√∫ce gener√°cie. Chy≈• si jeden z 5 DENN√ùCH ≈†≈§ASTN√ùCH ZLAT√ùCH SLOTov!">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#020617; --bg2:#071427; --card:#0f1b2a; --accent:#7c3aed; --accent2:#06b6d4;
    --muted:#9aa4b2; --good:#7ef0c7; --danger:#ff8a8a; --round:14px; --text:#e6eef8;
    --gold:#FFD700; --gold-dark:#e6c400;
    --delete-limit:rgba(255,138,138,0.2);
    --cta-bg:rgba(124,58,237,0.95);
  }
  /* ... (OSTATN√â ≈†T√ùLY ZOST√ÅVAJ√ö ROVNAK√â PRE ZJEDNODU≈†ENIE) ... */
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Arial;background:radial-gradient(ellipse at 10% 10%, rgba(124,58,237,0.12), transparent 10%), linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--text);min-height:100vh; padding-bottom: 70px;}
  .wrap{max-width:1100px;margin:0 auto;padding:20px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:700;color:white;font-size:18px}
  h1{margin:0;font-size:20px}
  .subtitle{color:var(--muted);font-size:13px}
  .lang{display:flex;gap:8px}
  .lang button{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:8px 10px;border-radius:8px;cursor:pointer}
  .lang button.active{border-color:var(--accent);color:white;box-shadow:0 8px 30px rgba(124,58,237,0.06)}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
  @media(max-width:960px){.grid{grid-template-columns:1fr}}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:var(--round)}
  label{font-size:13px;color:var(--muted)}
  input[type="text"], textarea, select{width:100%;padding:10px;border-radius:10px;border:0;background:rgba(255,255,255,0.02);color:var(--text);margin-top:8px}
  textarea{min-height:90px}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:10px}
  .btn{background:linear-gradient(90deg,var(--accent),var(--accent2));color:white;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600;}
  .ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:10px 14px;border-radius:10px;cursor:pointer}
  .list{margin-top:12px;display:flex;flex-direction:column;gap:10px;max-height:600px;overflow:auto}
  .item{padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);display:flex;gap:12px;align-items:flex-start;justify-content:space-between;border:1px solid transparent;transition:all 0.3s;}
  .item:hover{background:rgba(255,255,255,0.04)}
  .meta{color:var(--muted);font-size:13px}
  .highlight-paid{
    background:linear-gradient(180deg, rgba(255,215,0,0.07), rgba(255,215,0,0.03)) !important;
    border-color:var(--gold);
    box-shadow:0 0 0 2px var(--gold), 0 15px 40px rgba(255,215,0,0.15);
  }
  .tag-paid{background:linear-gradient(90deg,#ffd166,#ff9f1c);color:#111;padding:4px 8px;border-radius:6px;font-weight:700;margin-left:8px;font-size:12px;letter-spacing:0.5px;}
  .small{font-size:13px;color:var(--muted)}
  footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
  .avatar {width:56px;height:56px;border-radius:10px;object-fit:cover;background:#111}
  .char-count {float:right;font-size:12px;color:var(--muted)}
  .hero {
    display:flex;align-items:center;gap:12px;padding:16px;border-radius:var(--round);margin-bottom:12px;
    background:linear-gradient(90deg,var(--accent),var(--accent2));
    color:white;
    position:relative;
    overflow:hidden;
  }
  .hero-text {z-index:1}
  .capsule-anim {
    position:absolute;right:0;top:-10px;opacity:0.2;
    font-size:100px;
    transform:rotate(-15deg);
    animation:pulse-float 6s infinite ease-in-out;
    z-index:0;
  }
  @keyframes pulse-float {
    0% {transform:translateY(0) scale(1) rotate(-15deg); opacity:0.15;}
    50% {transform:translateY(-10px) scale(1.05) rotate(-15deg); opacity:0.25;}
    100% {transform:translateY(0) scale(1) rotate(-15deg); opacity:0.15;}
  }
  .time-limit {
    font-weight:600;
    color:var(--danger);
    background-color:var(--delete-limit);
    padding:3px 6px;
    border-radius:4px;
    font-size:11px;
    margin-left:8px;
  }
  /* VIZU√ÅLNA DEGRAD√ÅCIA NEPLATEN√âHO ODKAZU */
  .item.temporary {
    border-left:4px solid var(--danger);
    opacity:0.6;
    filter: blur(1.0px);
    transition: all 0.5s;
  }
  .item.temporary:hover {
    opacity: 0.9;
    filter: blur(0.2px);
  }

  /* STICKY CTA FOOTER */
  .sticky-cta {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: var(--cta-bg);
    box-shadow: 0 -4px 15px rgba(0,0,0,0.3);
    padding: 10px 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    z-index: 1000;
    backdrop-filter: blur(8px);
    border-top: 1px solid rgba(255,255,255,0.1);
  }
  .sticky-cta .btn {
    font-size: 16px;
    padding: 12px 20px;
    background: linear-gradient(90deg, var(--gold-dark), var(--gold));
    color: #111;
    font-weight: 900;
    text-transform: uppercase;
    animation: bounce-gold 3s infinite ease-in-out;
  }
  @keyframes bounce-gold {
    0%, 100% { transform: translateY(0); box-shadow: 0 0 15px rgba(255,215,0,0.4); }
    50% { transform: translateY(-4px); box-shadow: 0 6px 20px rgba(255,215,0,0.7); }
  }
  .cta-text {
    font-size: 14px;
    font-weight: 500;
    color: white;
    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  }
  @media(max-width:600px){
    .sticky-cta {flex-direction: column; gap: 8px; padding: 8px 10px;}
    .sticky-cta .btn {width: 100%;}
    .cta-text {font-size: 12px;}
  }

  /* VYLEP≈†EN√â TLAƒåIDLO V FORMUL√ÅRI */
  #payLinkBtn {
    flex-grow: 1;
    font-size: 18px !important;
    padding: 14px 20px !important;
  }
  /* UPOZORNENIE NA LIMIT */
  .limit-info {
    font-size: 14px;
    font-weight: 700;
    color: var(--gold);
    padding: 8px;
    text-align: center;
    border: 1px dashed var(--gold);
    border-radius: 8px;
    margin-bottom: 12px;
  }
  /* NOV√ù ≈†T√ùL PRE ZDARMA TLAƒåIDLO PRI AKCII */
  .free-gold-btn {
    background: linear-gradient(90deg, #10b981, #06b6d4) !important;
    color: white !important;
    font-weight: 900 !important;
    box-shadow: 0 0 10px rgba(6, 182, 212, 0.5);
  }

</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">OPƒΩ</div>
        <div>
          <h1 id="title">Odkaz pre ƒæudstvo</h1>
          <div id="subtitle" class="subtitle">Digit√°lna Kapsula ƒåasu v. 9.0 | ≈†≈§ASTN√ù SLOT EDITION</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div class="lang">
          <button data-lang="sk" class="lang-btn active">SK</button>
          <button data-lang="en" class="lang-btn">EN</button>
          <button data-lang="de" class="lang-btn">DE</button>
          <button data-lang="cs" class="lang-btn">CZ</button>
        </div>
      </div>
    </header>

    <div class="hero">
        <span class="capsule-anim">‚è≥</span>
        <div class="hero-text">
            <div style="font-size:24px; font-weight:900; line-height:1.2;">TVOJ ODKAZ PRE BUD√öCNOS≈§</div>
            <div style="margin-top:8px;">
                <span style="font-weight:700">DOƒåASN√ù (Riziko):</span> **VYMAZANIE** za 48 hod√≠n. Strata Hodnosti.
            </div>
            <div style="margin-top:4px;">
                <span style="font-weight:700; color:var(--gold)">ZLAT√ù (1‚Ç¨ / ≈†≈•astn√Ω Slot ZADARMO):</span> **TRVAL√â ULO≈ΩENIE**, Hodnos≈• zachovan√°, Prioritn√Ω Status.
            </div>
        </div>
    </div>

    <div class="grid">
      <main>
        <div class="card">
          <h3 id="formTitle">Prida≈• odkaz a zvoli≈• trv√°cnos≈•</h3>
          
          <div id="dailyLimitInfo" class="limit-info"></div>

          <label id="labelName">Meno / Prez√Ωvka (voliteƒæn√©)</label>
          <input id="author" type="text" placeholder="" />

          <label id="labelMessage" style="margin-top:12px">Odkaz (max 300 znakov) <span id="charCount" class="char-count">0/300</span></label>
          <textarea id="message" maxlength="300" placeholder=""></textarea>

          <div style="margin-top:10px; padding:12px; background:rgba(255,255,255,0.03); border-radius:10px; border:1px solid var(--gold-dark);">
            <div style="font-weight:700; color:var(--gold); margin-bottom:8px;">MO≈ΩNOSTI ULO≈ΩENIA:</div>
            <div class="controls" style="margin-top:0;">
                <button id="payLinkBtn" class="btn" style="background:linear-gradient(90deg, var(--gold-dark), var(--gold)); color: #111;">
                    üîí ZAPLA≈§ 1‚Ç¨ ‚Äî ZLAT√ù Odkaz (Trval√© Ulo≈æenie)
                </button>
                <button id="saveFree" class="ghost">
                    Ulo≈æi≈• DOƒåASNE (48 hod√≠n)
                </button>
            </div>
          </div>
          <div class="small" style="margin-top:10px; color:var(--danger); font-weight:700;">
            *Neplaten√© odkazy sa po 48 hodin√°ch bez milosti vyma≈æ√∫! Nechaj svoj odkaz PRE≈ΩI≈§!
          </div>


          <div style="margin-top:20px">
            <label id="labelSearch">Hƒæada≈• a triedi≈• odkazy</label>
            <div style="display:flex;gap:8px;margin-top:8px">
              <input id="search" type="text" placeholder="">
              <select id="sort">
                <option value="paid">ZLAT√â Odkazy najprv</option>
                <option value="new">Najnov≈°ie</option>
                <option value="likes">Najviac lajkovan√©</option>
                <option value="views">Najviac ƒç√≠tan√©</option>
                <option value="old">Najstar≈°ie</option>
                <option value="random">N√°hodn√©</option>
              </select>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h3 id="listTitle">Zoznam odkazov</h3>
            <div class="small" id="count">0 odkazov</div>
          </div>
          <div id="list" class="list" style="margin-top:10px">
            <div class="small">≈Ωiadne odkazy</div>
          </div>
        </div>
      </main>

      <aside>
        <div class="card">
          <h3 id="statsTitle">≈†tatistiky Kapsuly ƒåasu</h3>
          <div class="small" style="margin-top:8px">Celkom odkazov: <strong id="statTotal">0</strong></div>
          <div class="small">Trvalo ulo≈æen√Ωch (ZLAT√ùCH): <strong id="statPaid" style="color:var(--gold);font-weight:700">0</strong></div>
          <div class="small">Doƒçasn√Ωch odkazov (vypr≈°√≠): <strong id="statTemporary" style="color:var(--danger);font-weight:700">0</strong></div>
          <div class="small">Usporen√° Hodnota: <strong id="statSavedValue" style="color:#10b981;font-weight:700">0 ‚Ç¨</strong></div> <div class="small" style="margin-top:10px">Celkom zobrazen√≠: <strong id="statViews">0</strong></div>
          <div class="small">Celkom lajkov: <strong id="statLikes">0</strong></div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3 id="topTitle">Najpopul√°rnej≈°ie odkazy</h3>
          <div id="topList" style="display:flex;flex-direction:column;gap:8px;margin-top:8px"></div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3 id="helpTitle">NEPR√çƒé O SVOJU HODNOS≈§!</h3>
          <div class="small" id="helpText">
            Ka≈æd√Ω odkaz m√° unik√°tnu Hodnos≈• (#). <br>
            <strong style="color:var(--danger)">Doƒçasn√Ω odkaz</strong> m√° platnos≈• len 48 hod√≠n. Ak nezaplat√≠≈° 1 ‚Ç¨, Tvoj odkaz sa vyma≈æe a Tvoja **Hodnos≈• prepadne NAV≈ΩDY**!
            <br><br>
            <strong style="color:var(--gold)">Zlat√Ω odkaz (1‚Ç¨ / ≈†≈•astn√Ω Slot)</strong> sa stane trvalou s√∫ƒças≈•ou Kapsuly ƒåasu a zachov√° si Tvoju unik√°tnu Hodnos≈•, ktor√° sa s ka≈æd√Ωm pridan√Ωm odkazom st√°va **cennej≈°ou**!
          </div>
        </div>
      </aside>
    </div>

    <footer>¬© 2025 Odkaz pre ƒæudstvo ‚Äî Verzia 9.0 | Limitovan√° ≈†anca D≈àa!</footer>

  </div>

  <div class="sticky-cta" id="stickyCta">
    <div class="cta-text" id="ctaText">
      ‚åõ Posledn√° ≈°anca! Nenechaj svoj odkaz VYMAZA≈§! Zapla≈• 1‚Ç¨ a ulo≈æ ho NATRVALO!
    </div>
    <button id="stickyPayBtn" class="btn">
      UROB ODKAZ TRVAL√ù (1‚Ç¨)
    </button>
  </div>

<script>
/* -----------------------
   KON≈†TANTY A GLOB√ÅLNY STAV
   ----------------------- */
const TEMP_DURATION_MS = 48 * 60 * 60 * 1000;
const DELETE_INTERVAL_MS = 60 * 60 * 1000;
const DAILY_FREE_LIMIT = 5; 
const MESSAGE_PRICE = 1.00; // Cena za trval√© ulo≈æenie
const STORAGE_KEY = 'odkaz_pre_ludstvo_v9';
const DAILY_LIMIT_KEY = 'op_daily_free_v9';

// Denno-limitn√Ω stav
let dailyLimitState = loadDailyLimit();
let entries = loadEntries();

const I18N = {
  sk: {
    title: 'Odkaz pre ƒæudstvo',
    subtitle: 'Digit√°lna Kapsula ƒåasu v. 9.0 | ≈†≈§ASTN√ù SLOT EDITION',
    formTitle: 'Prida≈• odkaz a zvoli≈• trv√°cnos≈•',
    labelName: 'Meno / Prez√Ωvka (voliteƒæn√©)',
    labelMessage: 'Odkaz (max 300 znakov)',
    labelSearch: 'Hƒæada≈• a triedi≈• odkazy',
    listTitle: 'Zoznam odkazov',
    statsTitle: '≈†tatistiky Kapsuly ƒåasu',
    topTitle: 'Najpopul√°rnej≈°ie odkazy',
    payLinkText: 'üîí ZAPLA≈§ 1‚Ç¨ ‚Äî ZLAT√ù Odkaz (Trval√© Ulo≈æenie)',
    saveFree: 'Ulo≈æi≈• DOƒåASNE (48 hod√≠n)',
    placeholderMsg: 'Nap√≠≈° vetu pre bud√∫ce gener√°cie, sk√¥r ne≈æ bude neskoro...',
    paidTag: 'ZLAT√ù üåü',
    temporaryTag: (time) => `Vypr≈°√≠ za ${time} üö®`,
    anonymous: 'Anonym',
    noResults: '≈Ωiadne v√Ωsledky',
    alertMessage: 'Nezabudni nap√≠sa≈• odkaz!',
    alertMaxChars: 'Pr√≠li≈° dlh√©. Max 300 znakov.',
    alertPayError: 'PAYMENT LINK nebol nastaven√Ω. Simulova≈• ZLAT√ö verziu? (OK = platen√©, Cancel = doƒçasn√©)',
    rank: 'Hodnos≈•',
    shareText: 'Zdieƒæaj',
    ctaStickyText: '‚åõ Posledn√° ≈°anca! Nenechaj svoj odkaz VYMAZA≈§! Zapla≈• 1‚Ç¨ a ulo≈æ ho NATRVALO!',
    ctaStickyBtn: 'UROB ODKAZ TRVAL√ù (1‚Ç¨)',
    dailyLimitText: (remaining) => remaining > 0 
      ? `üçÄ ≈†ANCA D≈áA: Z√≠skaj TRVAL√ù odkaz ZDARMA! Zost√°va **${remaining} ≈†≈§ASTN√ùCH SLOTov**!`
      : `‚ö†Ô∏è Dne≈°n√Ω limit (${DAILY_FREE_LIMIT}) bol vyƒçerpan√Ω. Zlat√Ω odkaz (Trval√© ulo≈æenie) je len za 1‚Ç¨!`,
    alertThanksFree: (savedValue) => `GRATULUJEME! Z√≠skal si ≈†≈§ASTN√ù SLOT! Tvoj ZLAT√ù ODKAZ bol ulo≈æen√Ω NATRVALO. U≈°etril si ${savedValue} ‚Ç¨! ≈†√≠r to ƒèalej!`,
    alertThanksTemporary: '√öspe≈°ne pridan√©, ale POZOR! Doƒçasn√Ω odkaz bude akt√≠vny len 48 hod√≠n. Nechaj si prepadn√∫≈• svoju Hodnos≈• a 1 ‚Ç¨ hodnotu?'
  },
  en: { 
    title: 'Message to Humanity',
    subtitle: 'Digital Time Capsule v. 9.0 | Lucky Slot Edition',
    saveFree: 'Save TEMPORARILY (48 hours)',
    dailyLimitText: (remaining) => remaining > 0
      ? `üçÄ LUCKY CHANCE: Get a PERMANENT message for FREE! **${remaining} LUCKY SLOTS LEFT**!`
      : `‚ö†Ô∏è Today's limit (${DAILY_FREE_LIMIT}) has been reached. Gold Message (Permanent) is just ‚Ç¨1!`,
    alertThanksFree: (savedValue) => `CONGRATULATIONS! You got a LUCKY SLOT! Your GOLD MESSAGE has been stored PERMANENTLY. You saved ${savedValue} ‚Ç¨! Spread the word!`,
    alertThanksTemporary: 'Successfully added, but BEWARE! Temporary message will only be active for 48 hours. Risk losing your Rank and ‚Ç¨1 value?'
  },
  de: {
    title: 'Botschaft an die Menschheit',
    subtitle: 'Digitale Zeitkapsel v. 9.0 | Gl√ºcks-Slot Edition',
    saveFree: 'Vor√ºbergehend speichern (48 Stunden)',
    dailyLimitText: (remaining) => remaining > 0
      ? `üçÄ GL√úCKSCANCE: Erhalte eine PERMANENTE Nachricht KOSTENLOS! **${remaining} GL√úCKS-SLOTS** √ºbrig!`
      : `‚ö†Ô∏è Das heutige Limit (${DAILY_FREE_LIMIT}) ist erreicht. Gold-Nachricht (Permanent) nur f√ºr 1‚Ç¨!`,
    alertThanksFree: (savedValue) => `HERZLICHEN GL√úCKWUNSCH! Sie haben einen Gl√ºcks-Slot erhalten! Ihre GOLD-NACHRICHT wurde DAUERHAFT gespeichert. Sie haben ${savedValue} ‚Ç¨ gespart! Erz√§hlen Sie es weiter!`,
    alertThanksTemporary: 'Erfolgreich hinzugef√ºgt, aber ACHTUNG! Die tempor√§re Nachricht ist nur 48 Stunden aktiv. Riskieren Sie den Verlust Ihres Rangs und des ‚Ç¨1 Wertes?'
  },
  cs: {
    title: 'Odkaz pro lidstvo',
    subtitle: 'Digit√°ln√≠ Kapsle ƒåasu v. 9.0 | ≈†≈•astn√Ω Slot Edition',
    saveFree: 'Ulo≈æit DOƒåASNƒö (48 hodin)',
    dailyLimitText: (remaining) => remaining > 0
      ? `üçÄ ≈†ANCE DNE: Z√≠skej TRVAL√ù vzkaz ZDARMA! Zb√Ωv√° **${remaining} ≈†≈§ASTN√ùCH SLOT≈Æ**!`
      : `‚ö†Ô∏è Dne≈°n√≠ limit (${DAILY_FREE_LIMIT}) byl vyƒçerp√°n. Zlat√Ω vzkaz (Trval√© ulo≈æen√≠) je jen za 1‚Ç¨!`,
    alertThanksFree: (savedValue) => `GRATULUJEME! Z√≠skal jsi ≈†≈§ASTN√ù SLOT! Tv≈Øj ZLAT√ù VZKAZ byl ulo≈æen NATRVALO. U≈°et≈ôil jsi ${savedValue} Kƒç! ≈†i≈ô to d√°l!`, // Pre CZ men√≠m menu na CZK pre z√°bavu
    alertThanksTemporary: '√öspƒõ≈°nƒõ p≈ôid√°no, ale POZOR! Doƒçasn√Ω vzkaz bude aktivn√≠ jen 48 hodin. Rizikuje≈° ztr√°tu sv√© Hodnosti a 1 ‚Ç¨ hodnoty?'
  }
};


/* -----------------------
   LIMIT LOGIKA
   ----------------------- */
function loadDailyLimit() {
    try {
        const raw = localStorage.getItem(DAILY_LIMIT_KEY);
        const state = raw ? JSON.parse(raw) : { count: 0, date: now() };
        
        const msPerDay = 24 * 60 * 60 * 1000;
        if (now() - state.date > msPerDay) {
            return { count: 0, date: now() }; 
        }
        return state;
    } catch (e) {
        return { count: 0, date: now() };
    }
}
function saveDailyLimit() {
    localStorage.setItem(DAILY_LIMIT_KEY, JSON.stringify(dailyLimitState));
}
function useFreeSlot() {
    if (dailyLimitState.count < DAILY_FREE_LIMIT) {
        dailyLimitState.count++;
        dailyLimitState.date = now(); 
        saveDailyLimit();
        return true;
    }
    return false;
}
function getRemainingFreeSlots() {
    dailyLimitState = loadDailyLimit();
    return DAILY_FREE_LIMIT - dailyLimitState.count;
}


/* -----------------------
   Helpers & DOM refs
   ----------------------- */
const el = id => document.getElementById(id);

const authorEl = el('author');
const messageEl = el('message');
const payLinkBtn = el('payLinkBtn');
const saveFree = el('saveFree');
const dailyLimitInfoEl = el('dailyLimitInfo');
const stickyPayBtn = el('stickyPayBtn');
const listEl = el('list');
const statTotal = el('statTotal');
const statPaid = el('statPaid');
const statTemporary = el('statTemporary');
const statViews = el('statViews');
const statLikes = el('statLikes');
const topList = el('topList');
const statSavedValue = el('statSavedValue'); // NOV√ù REF

let LANG = localStorage.getItem('op_lang') || 'sk';
applyLang(LANG);

/* -----------------------
   Utils
   ----------------------- */
function uid(prefix='id'){ return prefix + Math.random().toString(36).slice(2,10); }
function now(){ return Date.now(); }
function getRemainingTime(ts){
    const remaining = (ts + TEMP_DURATION_MS) - now();
    if(remaining <= 0) return null;
    const h = Math.floor(remaining / (1000 * 60 * 60));
    const m = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
    if(h > 0) return `${h}h ${m}m`;
    return `${m}m`;
}
function formatDate(ts){ return new Date(ts).toLocaleDateString(LANG, {year:'numeric',month:'short',day:'numeric'}); }
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&quot;',"'":'&#39;'})[c]); }
function truncate(s,n){ return s.length>n ? s.slice(0,n-1)+'‚Ä¶' : s; }
function simulateTranslation(text, targetLang) {
    if (targetLang === 'sk') return text;
    let emoji = '';
    let langName = '';
    if (targetLang === 'en') { emoji = 'üåç'; langName = 'ENG'; }
    else if (targetLang === 'de') { emoji = 'üè∞'; langName = 'DEU'; }
    else if (targetLang === 'cs') { emoji = 'üç∫'; langName = 'CZE'; }
    return `<span style="color:var(--muted); font-size:12px">${emoji} (${langName}) </span>` + text;
}


/* -----------------------
   Perzistencia
   ----------------------- */
function loadEntries(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    let loaded = raw ? JSON.parse(raw) : [];
    const filtered = loaded.filter(e => e.paid || (e.ts + TEMP_DURATION_MS > now()));
    if(filtered.length !== loaded.length) {
        entries = filtered;
        saveEntries();
    }
    return filtered;
  }catch(e){ console.error(e); return []; }
}
function saveEntries(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(entries)); }
setInterval(loadEntries, DELETE_INTERVAL_MS);


/* -----------------------
   i18n & UI
   ----------------------- */
function applyLang(lang){
  LANG = lang;
  localStorage.setItem('op_lang', lang);
  const T = I18N[lang];
  
  // Aktualiz√°cia limitu
  const remaining = getRemainingFreeSlots();
  dailyLimitInfoEl.innerHTML = T.dailyLimitText(remaining).replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
  
  // Vizu√°lne √∫pravy tlaƒçidiel na z√°klade limitu
  if (remaining > 0) {
      saveFree.textContent = `üçÄ CHY≈§ ZLAT√ù SLOT ZDARMA! (${remaining} ost√°va)`;
      saveFree.classList.add('free-gold-btn');
      saveFree.classList.remove('ghost');
  } else {
      saveFree.textContent = T.saveFree;
      saveFree.classList.remove('free-gold-btn');
      saveFree.classList.add('ghost');
  }

  // Ostatn√© texty UI
  el('title').textContent = T.title;
  el('subtitle').textContent = T.subtitle;
  el('formTitle').textContent = T.formTitle;
  el('labelName').textContent = T.labelName;
  el('labelMessage').textContent = T.labelMessage + ` (${messageEl.value.length}/300)`;
  // ... (aktualiz√°cia v≈°etk√Ωch I18N textov) ...
  
  document.querySelectorAll('.lang-btn').forEach(b=>b.classList.toggle('active', b.dataset.lang===lang));
  render();
}


/* -----------------------
   Render & UI
   ----------------------- */
function render(){
  const T = I18N[LANG];
  
  // ... (filter & sort logika z V8.0) ...
  const q = (el('search').value || '').trim().toLowerCase();
  let list = entries.slice();
  list.forEach((e, i) => e.rank = i + 1);
  if(q) list = list.filter(e => (e.text + ' ' + (e.author||'')).toLowerCase().includes(q));
  const s = el('sort').value;
  if(s==='paid') list.sort((a,b)=> (b.paid?1:0) - (a.paid?1:0) || b.ts-a.ts);
  else if(s==='new') list.sort((a,b)=>b.ts-a.ts);
  // ... (pokraƒçovanie triedenia) ...

  listEl.innerHTML = '';
  if(list.length===0){
    listEl.innerHTML = `<div class="small">${T.noResults}</div>`;
  } else {
    list.forEach(e=>{
      const isTemporary = !e.paid;
      const remainingTime = isTemporary ? getRemainingTime(e.ts) : null;
      let displayedText = escapeHtml(e.text);
      if (LANG !== 'sk' && isTemporary) {
          displayedText = simulateTranslation(displayedText, LANG);
      } else if (LANG !== 'sk' && e.paid) {
           displayedText = `<span style="color:var(--gold); font-size:12px">ü•á (Original Text) </span>` + displayedText;
      }
      
      const item = document.createElement('div');
      item.className = 'item' + (e.paid ? ' highlight-paid' : '') + (isTemporary ? ' temporary' : '');
      item.dataset.id = e.id;
      item.innerHTML = `
        <div style="display:flex;gap:12px;align-items:flex-start;flex:1">
          <img class="avatar" src="${escapeHtml(e.avatar||'https://picsum.photos/56?random='+Math.floor(Math.random()*10000))}" alt="avatar"/>
          <div style="flex:1">
            <div style="display:flex;align-items:center;gap:8px">
              <div style="font-weight:700">${escapeHtml(e.author||T.anonymous)}</div>
              <div class="meta">${formatDate(e.ts)}</div>
              <span class="meta" style="color:var(--accent2); font-weight:700;">#${e.rank}</span>
              ${e.paid?`<span class="tag-paid">${T.paidTag}</span>`:''}
              ${isTemporary?`<span class="time-limit">${T.temporaryTag(remainingTime || '0m')}</span>`:''}
            </div>
            <div style="margin-top:8px;font-size:15px">${displayedText}</div>
            <div style="margin-top:8px" class="meta">
              <span data-id="${e.id}" data-action="like" style="cursor:pointer;margin-right:8px">‚ù§ ${e.likes}</span>
              <span>Views: ${e.views}</span>
              <button data-id="${e.id}" data-action="share" class="ghost" style="padding:4px 8px; margin-left:12px">${T.shareText}</button>
            </div>
          </div>
        </div>
      `;
      listEl.appendChild(item);
      e.views = (e.views||0) + 1;
    });
    saveEntries();
  }

  // AKTUALIZ√ÅCIA ≈†TATIST√çK
  const paidCount = entries.filter(e=>e.paid).length;
  const tempCount = entries.filter(e=>!e.paid).length;
  const savedValue = paidCount * MESSAGE_PRICE; // V≈°etky trval√© odkazy maj√∫ hodnotu 1‚Ç¨
  
  statTotal.textContent = entries.length;
  statPaid.textContent = paidCount;
  statTemporary.textContent = tempCount;
  statViews.textContent = entries.reduce((s,e)=>s+e.views,0);
  statLikes.textContent = entries.reduce((s,e)=>s+e.likes,0);
  statSavedValue.textContent = `${savedValue.toFixed(2)} ‚Ç¨`; // Nov√° ≈°tatistika
  el('count').textContent = list.length + ' ' + (LANG==='sk' || LANG==='cs' ? 'odkazov' : 'messages');

  // TOP LIST
  const top = entries.slice().sort((a,b)=>b.likes-a.likes).slice(0,5);
  topList.innerHTML = '';
  if(top.length===0) topList.innerHTML = '<div class="small">‚Äî</div>'
  else top.forEach(t=>{
    const d = document.createElement('div'); d.className='small';
    d.innerHTML = `<strong>#${t.rank} ${escapeHtml(t.author||T.anonymous)}</strong>: ${escapeHtml(truncate(t.text,60))} ‚Äî <span style="font-weight:700;color:white">‚ù§ ${t.likes}</span>`;
    topList.appendChild(d);
  });
}


/* -----------------------
   Actions & Payment 
   ----------------------- */
function addEntry(asPaid, isFreeSlot = false){
  const T = I18N[LANG];
  const author = authorEl.value.trim() || null;
  const text = messageEl.value.trim();

  if(!text) return alert(T.alertMessage);
  if(text.length>300) return alert(T.alertMaxChars);

  const entry = {
    id: uid('o_'),
    author,
    text,
    ts: now(),
    likes: 0,
    views: 0,
    paid: Boolean(asPaid || isFreeSlot),
    avatar: 'https://picsum.photos/56?random=' + Math.floor(Math.random()*10000)
  };
  entries.unshift(entry);
  saveEntries(); 
  
  // RESET FORMUL√ÅRA 
  authorEl.value=''; 
  messageEl.value='';
  el('charCount').textContent = `0/300`;
  applyLang(LANG); // Volanie applyLang automaticky vol√° render() a aktualizuje limit!
  
  // VYLEP≈†EN√â ALERTOVANIE
  if (isFreeSlot) {
      const savedValue = LANG === 'cs' ? '25 Kƒç' : '1.00'; // Kotvenie hodnoty pre CS trh
      alert(T.alertThanksFree(savedValue));
  } else if (asPaid) {
      alert(T.alertThanksFree('1.00')); // Po zaplaten√≠ povieme, ≈æe si ho k√∫pil
  } else {
      alert(T.alertThanksTemporary);
  }
}

const PAYMENT_LINK = ''; 
function handlePaymentAction(){
    const T = I18N[LANG];
    if(!messageEl.value.trim()) return alert(T.alertMessage);

    if(!PAYMENT_LINK){
        if(confirm(T.alertPayError)){
            addEntry(true); 
        }
        return;
    }
    // Realistick√Ω flow simul√°cie:
    window.open(PAYMENT_LINK, '_blank');
    if(confirm("Po dokonƒçen√≠ platby stlaƒç OK na aktiv√°ciu ZLAT√âHO ODKAZU.")){
        addEntry(true);
    } 
}

function handleFreeAction(){
    const T = I18N[LANG];
    if(!messageEl.value.trim()) return alert(T.alertMessage);

    const remaining = getRemainingFreeSlots();
    if (remaining > 0) {
        // ZLAT√ù ODKAZ ZDARMA (≈†≈•astn√Ω Slot)
        if (confirm(`GRATULUJEME! M√°≈° ≈°ancu z√≠ska≈• ZLAT√ù SLOT ZDARMA! Chce≈° to sk√∫si≈•? (${remaining} ost√°va)`)) {
             useFreeSlot();
             addEntry(false, true); 
        }
    } else {
        // Ulo≈æi≈• len doƒçasne (rizikov√©)
        if (confirm(`Limit (${DAILY_FREE_LIMIT}) bol vyƒçerpan√Ω. Ulo≈æi≈• len DOƒåASNE (48h) a riskova≈•, ≈æe PR√çDE≈† O SVOJU HODNOS≈§?`)) {
            addEntry(false);
        }
    }
}


// Bindovanie na CTA tlaƒçidl√° a Event Listeners
payLinkBtn.addEventListener('click', handlePaymentAction);
stickyPayBtn.addEventListener('click', handlePaymentAction);
saveFree.addEventListener('click', handleFreeAction);
el('message').addEventListener('input', ()=> el('charCount').textContent = `${el('message').value.length}/300`);
el('sort').addEventListener('change', render);
el('search').addEventListener('input', render);

/* -----------------------
   Init
   ----------------------- */
setInterval(loadEntries, DELETE_INTERVAL_MS); 
applyLang(LANG); 
</script>
</body>
</html>
