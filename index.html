<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Odkaz pre ľudstvo — ver. 2.1</title>
<meta name="description" content="Zanechaj vetu pre budúce generácie — multijazyčné, platené ukladanie, moderný dizajn.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#020617; --bg2:#071427; --card:#0f1b2a; --accent:#7c3aed; --accent2:#06b6d4;
    --muted:#9aa4b2; --good:#7ef0c7; --danger:#ff8a8a; --round:14px; --text:#e6eef8;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Arial;background:radial-gradient(ellipse at 10% 10%, rgba(124,58,237,0.12), transparent 10%), linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--text);min-height:100vh}
  .wrap{max-width:1100px;margin:0 auto;padding:20px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:56px;height:56;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:700;color:white;font-size:18px}
  h1{margin:0;font-size:20px}
  .subtitle{color:var(--muted);font-size:13px}
  .lang{display:flex;gap:8px}
  .lang button{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:8px 10px;border-radius:8px;cursor:pointer}
  .lang button.active{border-color:var(--accent);color:white;box-shadow:0 8px 30px rgba(124,58,237,0.06)}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
  @media(max-width:960px){.grid{grid-template-columns:1fr}}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:var(--round)}
  label{font-size:13px;color:var(--muted)}
  input[type="text"], textarea, select{width:100%;padding:10px;border-radius:10px;border:0;background:rgba(255,255,255,0.02);color:var(--text);margin-top:8px}
  textarea{min-height:90px}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:10px}
  .btn{background:linear-gradient(90deg,var(--accent),var(--accent2));color:white;border:0;padding:10px 14px;border-radius:10px;cursor:pointer}
  .ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:8px 12px;border-radius:8px;cursor:pointer}
  .list{margin-top:12px;display:flex;flex-direction:column;gap:10px;max-height:480px;overflow:auto}
  .item{padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);display:flex;gap:12px;align-items:flex-start;justify-content:space-between}
  .meta{color:var(--muted);font-size:13px}
  .tag-paid{background:linear-gradient(90deg,#ffd166,#ff9f1c);color:#111;padding:6px 8px;border-radius:8px;font-weight:700;margin-left:8px}
  .small{font-size:13px;color:var(--muted)}
  footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
  /* small responsive image header */
  .hero {
    display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;margin-bottom:12px;background:linear-gradient(90deg,rgba(124,58,237,0.06),rgba(6,182,212,0.03));
  }
  .planet {width:72px;height:72px;border-radius:50%;background-image:url('https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/Globe_icon_English.svg/512px-Globe_icon_English.svg.png');background-size:cover;background-position:center;opacity:0.9}
  /* subtle float animation */
  @keyframes floaty { 0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)} }
  .planet {animation:floaty 4s ease-in-out infinite;}
  .highlight{box-shadow:0 12px 40px rgba(124,58,237,0.08)}
  /* image badges for items */
  .avatar {width:56px;height:56;border-radius:10px;object-fit:cover;background:#111}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">OPĽ</div>
        <div>
          <h1 id="title">Odkaz pre ľudstvo</h1>
          <div id="subtitle" class="subtitle">Zanechaj vetu pre budúce generácie — 1 € zvýraznenie</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div class="lang">
          <button data-lang="sk" class="lang-btn active">SK</button>
          <button data-lang="en" class="lang-btn">EN</button>
          <button data-lang="de" class="lang-btn">DE</button>
        </div>
      </div>
    </header>

    <div class="hero">
      <div class="planet" aria-hidden="true"></div>
      <div>
        <div style="font-weight:700">Odkaz pre ľudstvo</div>
        <div class="small">Vytvor svoj odkaz, zaplať 1 € a tvoj text bude trvalo zvýraznený</div>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT -->
      <main>
        <div class="card">
          <h3 id="formTitle">Pridať odkaz</h3>
          <label id="labelName">Meno (voliteľné)</label>
          <input id="author" type="text" placeholder="" />

          <label id="labelMessage" style="margin-top:8px">Odkaz (max 300 znakov)</label>
          <textarea id="message" maxlength="300" placeholder=""></textarea>

          <div class="controls">
            <button id="payLinkBtn" class="btn">Zaplať 1€ (rýchly link)</button>
            <button id="stripeBtn" class="btn" style="display:none">Zaplať 1€ (Stripe)</button>
            <button id="saveFree" class="ghost">Uložiť zadarmo</button>
            <button id="previewBtn" class="ghost">Náhľad</button>
          </div>

          <div style="margin-top:12px">
            <label id="labelSearch">Hľadať</label>
            <div style="display:flex;gap:8px;margin-top:8px">
              <input id="search" type="text" placeholder="">
              <select id="sort">
                <option value="new">Najnovšie</option>
                <option value="old">Najstaršie</option>
                <option value="likes">Najviac lajkované</option>
                <option value="views">Najviac čítané</option>
                <option value="paid">Platené najprv</option>
                <option value="random">Náhodné</option>
              </select>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h3 id="listTitle">Zoznam odkazov</h3>
            <div class="small" id="count">0 odkazov</div>
          </div>
          <div id="list" class="list" style="margin-top:10px">
            <div class="small">Žiadne odkazy</div>
          </div>
        </div>
      </main>

      <!-- RIGHT -->
      <aside>
        <div class="card">
          <h3 id="statsTitle">Štatistiky</h3>
          <div class="small" style="margin-top:8px">Celkom: <strong id="statTotal">0</strong></div>
          <div class="small">Platené: <strong id="statPaid">0</strong></div>
          <div class="small">Zobrazenia: <strong id="statViews">0</strong></div>
          <div class="small">Lajky: <strong id="statLikes">0</strong></div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3 id="topTitle">Top odkazy</h3>
          <div id="topList" style="display:flex;flex-direction:column;gap:8px;margin-top:8px"></div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3 id="helpTitle">Info</h3>
          <div class="small" id="helpText">Platby sú zatiaľ simulované. Pre reálne platby nastav Stripe Payment Link alebo Stripe Checkout.</div>
        </div>
      </aside>
    </div>

    <footer>© 2025 Odkaz pre ľudstvo — Verzia 2.1</footer>
  </div>

<!-- Optional: include Stripe.js only if you will use Stripe Checkout server flow -->
<!-- <script src="https://js.stripe.com/v3/"></script> -->

<script>
/* -----------------------
   Multilingual strings
   ----------------------- */
const I18N = {
  sk: {
    title: 'Odkaz pre ľudstvo',
    subtitle: 'Zanechaj vetu pre budúce generácie — 1 € zvýraznenie',
    formTitle: 'Pridať odkaz',
    labelName: 'Meno (voliteľné)',
    labelMessage: 'Odkaz (max 300 znakov)',
    labelSearch: 'Hľadať',
    listTitle: 'Zoznam odkazov',
    statsTitle: 'Štatistiky',
    topTitle: 'Top odkazy',
    helpText: 'Platby sú zatiaľ simulované. Pre reálne platby nastav Stripe Payment Link alebo Stripe Checkout.',
    payLinkText: 'Zaplať 1€ (rýchly link)',
    stripeText: 'Zaplať 1€ (Stripe)',
    saveFree: 'Uložiť zadarmo',
    preview: 'Náhľad',
    placeholderMsg: 'Napíš vetu pre budúce generácie...'
  },
  en: {
    title: 'Message to Humanity',
    subtitle: 'Leave a short message for future generations — €1 to highlight',
    formTitle: 'Add a message',
    labelName: 'Name (optional)',
    labelMessage: 'Message (max 300 chars)',
    labelSearch: 'Search',
    listTitle: 'Messages',
    statsTitle: 'Statistics',
    topTitle: 'Top messages',
    helpText: 'Payments are simulated. Use Stripe Payment Link or Stripe Checkout for real payments.',
    payLinkText: 'Pay €1 (quick link)',
    stripeText: 'Pay €1 (Stripe)',
    saveFree: 'Save for free',
    preview: 'Preview',
    placeholderMsg: 'Write a message for future generations...'
  },
  de: {
    title: 'Botschaft an die Menschheit',
    subtitle: 'Hinterlasse eine kurze Nachricht für zukünftige Generationen — 1 € Highlight',
    formTitle: 'Nachricht hinzufügen',
    labelName: 'Name (optional)',
    labelMessage: 'Nachricht (max 300 Zeichen)',
    labelSearch: 'Suchen',
    listTitle: 'Nachrichten',
    statsTitle: 'Statistiken',
    topTitle: 'Top-Nachrichten',
    helpText: 'Zahlungen sind simuliert. Für echte Zahlungen Stripe Payment Link oder Stripe Checkout einrichten.',
    payLinkText: 'Zahle 1€ (schneller Link)',
    stripeText: 'Zahle 1€ (Stripe)',
    saveFree: 'Kostenlos speichern',
    preview: 'Vorschau',
    placeholderMsg: 'Schreibe eine Nachricht für zukünftige Generationen...'
  }
};

/* -----------------------
   Storage & data model
   (same schema as previous version)
   ----------------------- */
const STORAGE_KEY = 'odkaz_pre_ludstvo_v2';
let entries = loadEntries();

/* -----------------------
   Helpers & DOM refs
   ----------------------- */
const el = id => document.getElementById(id);
const langBtns = document.querySelectorAll('.lang-btn');

const authorEl = el('author');
const messageEl = el('message');
const payLinkBtn = el('payLinkBtn');
const stripeBtn = el('stripeBtn');
const saveFree = el('saveFree');
const previewBtn = el('previewBtn');
const searchEl = el('search');
const sortEl = el('sort');
const listEl = el('list');
const countEl = el('count');
const statTotal = el('statTotal');
const statPaid = el('statPaid');
const statViews = el('statViews');
const statLikes = el('statLikes');
const topList = el('topList');

let LANG = localStorage.getItem('op_lang') || 'sk';
applyLang(LANG);

/* -----------------------
   i18n
   ----------------------- */
function applyLang(lang){
  LANG = lang;
  localStorage.setItem('op_lang', lang);
  const T = I18N[lang];
  el('title').textContent = T.title;
  el('subtitle').textContent = T.subtitle;
  el('formTitle').textContent = T.formTitle;
  el('labelName').textContent = T.labelName;
  el('labelMessage').textContent = T.labelMessage;
  el('labelSearch').textContent = T.labelSearch;
  el('listTitle').textContent = T.listTitle;
  el('statsTitle').textContent = T.statsTitle;
  el('topTitle').textContent = T.topTitle;
  el('helpText').textContent = T.helpText;
  payLinkBtn.textContent = T.payLinkText;
  stripeBtn.textContent = T.stripeText;
  saveFree.textContent = T.saveFree;
  previewBtn.textContent = T.preview;
  messageEl.placeholder = T.placeholderMsg;
  // update active class
  langBtns.forEach(b=>b.classList.toggle('active', b.dataset.lang===lang));
  render();
}
langBtns.forEach(b=> b.addEventListener('click', ()=> applyLang(b.dataset.lang)));

/* -----------------------
   Persistence
   ----------------------- */
function loadEntries(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : [];
  }catch(e){ console.error(e); return []; }
}
function saveEntries(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(entries)); }

/* -----------------------
   Utilities
   ----------------------- */
function uid(prefix='id'){ return prefix + Math.random().toString(36).slice(2,10); }
function now(){ return Date.now(); }
function formatDate(ts){ return new Date(ts).toLocaleString(); }
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c]); }
function truncate(s,n){ return s.length>n ? s.slice(0,n-1)+'…' : s; }

/* -----------------------
   Render & UI
   ----------------------- */
function render(){
  // filter & sort
  const q = (searchEl.value || '').trim().toLowerCase();
  let list = entries.slice();
  if(q) list = list.filter(e => (e.text + ' ' + (e.author||'')).toLowerCase().includes(q));
  const s = sortEl.value;
  if(s==='new') list.sort((a,b)=>b.ts-a.ts);
  else if(s==='old') list.sort((a,b)=>a.ts-b.ts);
  else if(s==='likes') list.sort((a,b)=>b.likes-a.likes);
  else if(s==='views') list.sort((a,b)=>b.views-a.views);
  else if(s==='paid') list.sort((a,b)=> (b.paid?1:0) - (a.paid?1:0) || b.ts-a.ts);
  else if(s==='random') list.sort(()=>Math.random()-0.5);

  listEl.innerHTML = '';
  if(list.length===0){
    listEl.innerHTML = '<div class="small">Žiadne výsledky</div>';
  } else {
    list.forEach(e=>{
      const item = document.createElement('div');
      item.className = 'item' + (e.paid ? ' highlight' : '');
      item.innerHTML = `
        <div style="display:flex;gap:12px;align-items:flex-start;flex:1">
          <img class="avatar" src="${escapeHtml(e.avatar||'https://picsum.photos/56?random='+Math.floor(Math.random()*1000))}" alt="avatar"/>
          <div style="flex:1">
            <div style="display:flex;align-items:center;gap:8px">
              <div style="font-weight:700">${escapeHtml(e.author||(LANG==='sk'?'Anonym':'Anonymous'))}</div>
              <div class="meta">${formatDate(e.ts)}</div>
              ${e.paid?'<span class="tag-paid">PAID</span>':''}
            </div>
            <div style="margin-top:8px;font-size:15px">${escapeHtml(e.text)}</div>
            <div style="margin-top:8px" class="meta">Views: ${e.views} • Likes: ${e.likes}</div>
          </div>
        </div>
        <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
          <button class="btn" data-id="${e.id}" data-action="pay" ${e.paid?'disabled':''}>${e.paid? (LANG==='sk'?'Platené':'Paid') : (I18N[LANG].payLinkText)}</button>
          <button class="ghost" data-id="${e.id}" data-action="like">❤ ${e.likes}</button>
          <button class="ghost" data-id="${e.id}" data-action="view">Open</button>
        </div>
      `;
      listEl.appendChild(item);
    });
  }

  statTotal.textContent = entries.length;
  statPaid.textContent = entries.filter(e=>e.paid).length;
  statViews.textContent = entries.reduce((s,e)=>s+e.views,0);
  statLikes.textContent = entries.reduce((s,e)=>s+e.likes,0);
  countEl.textContent = list.length + ' ' + (LANG==='sk'?'odkazov':'messages');
  // top
  const top = entries.slice().sort((a,b)=>b.likes-a.likes).slice(0,5);
  topList.innerHTML = '';
  if(top.length===0) topList.innerHTML = '<div class="small">—</div>'
  else top.forEach(t=>{
    const d = document.createElement('div'); d.className='small';
    d.innerHTML = `<strong>${escapeHtml(t.author||'Anon')}</strong>: ${escapeHtml(truncate(t.text,60))} — ❤ ${t.likes}`;
    topList.appendChild(d);
  });
}

/* -----------------------
   Actions: add entry
   ----------------------- */
function addEntrySimulatedPayment(asPaid){
  const author = authorEl.value.trim() || null;
  const text = messageEl.value.trim();
  if(!text) return alert(LANG==='sk' ? 'Napíš odkaz.' : LANG==='en' ? 'Enter a message.' : 'Gib eine Nachricht ein.');
  if(text.length>300) return alert('Max 300 znakov.');

  const entry = {
    id: uid('o_'),
    author,
    text,
    ts: now(),
    likes: 0,
    views: 0,
    paid: Boolean(asPaid),
    avatar: 'https://picsum.photos/56?random=' + Math.floor(Math.random()*10000)
  };
  entries.push(entry);
  saveEntries(); render();
  authorEl.value=''; messageEl.value='';
  alert(LANG==='sk' ? 'Ďakujeme! Odkaz pridaný.' : LANG==='en' ? 'Thanks! Message added.' : 'Danke! Nachricht hinzugefügt.');
}

/* -----------------------
   Quick payment flow via Payment Link (no server)
   -----------------------
   - You create a Stripe Payment Link in your Stripe Dashboard (product: "Odkaz pre ľudstvo - highlight", price: 1 EUR)
   - Put the URL into PAYMENT_LINK variable below.
   - When user pays, Stripe will host checkout. To mark entry as 'paid' you need webhook/server (optional).
   - This quick flow opens the link in new tab; we simulate paid flag if user confirms.
   ----------------------- */
const PAYMENT_LINK = ''; // <-- PUT your Stripe Payment Link here (string)
payLinkBtn.addEventListener('click', ()=>{
  if(!PAYMENT_LINK){
    // fallback: simulate payment flow
    if(confirm('PAYMENT LINK not configured. Simulate payment and save as paid? (OK = paid, Cancel = save free)')){
      addEntrySimulatedPayment(true);
    } else {
      addEntrySimulatedPayment(false);
    }
    return;
  }
  // open payment link; we'll create entry after payment confirmation
  // simplest approach: open link, then ask user to paste confirmation/receipt or press OK to mark as paid.
  window.open(PAYMENT_LINK, '_blank');
  if(confirm('Po dokončení platby stlač OK a tvoj odkaz označíme ako platený (simulácia).')){
    addEntrySimulatedPayment(true);
  } else {
    addEntrySimulatedPayment(false);
  }
});

/* -----------------------
   Stripe Checkout full flow (server required)
   -----------------------
   - If you have server endpoint /create-checkout-session that returns {id: sessionId}
   - uncomment stripe.js script in the page head and set STRIPE_PUBLISHABLE_KEY and endpoint.
   - This block demonstrates how to call the endpoint and redirect to Checkout.
   ----------------------- */
const STRIPE_PUBLISHABLE = ''; // set if you implement full server flow
const CHECKOUT_ENDPOINT = '/.netlify/functions/createCheckout'; // or your endpoint
stripeBtn.addEventListener('click', async ()=>{
  if(!STRIPE_PUBLISHABLE || !CHECKOUT_ENDPOINT){ alert('Stripe Checkout not configured.'); return; }
  // create session on server
  try{
    const res = await fetch(CHECKOUT_ENDPOINT, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({amount_cents:100, currency:'eur', metadata:{note:'Odkaz pre ludstvo'}})
    });
    const data = await res.json();
    if(!data.id) throw new Error('No session id');
    const stripe = Stripe(STRIPE_PUBLISHABLE);
    await stripe.redirectToCheckout({sessionId: data.id});
  }catch(err){ console.error(err); alert('Chyba pri vytváraní platby.'); }
});

/* -----------------------
   Save free (no payment)
   ----------------------- */
saveFree.addEventListener('click', ()=> addEntrySimulatedPayment(false));

/* -----------------------
   Preview
   ----------------------- */
previewBtn.addEventListener('click', ()=>{
  const a = authorEl.value.trim() || (LANG==='sk'?'Anonym':'Anonymous');
  const t = messageEl.value.trim() || (LANG==='sk'?'—':'—');
  alert(`${a}:\n\n${t}`);
});

/* -----------------------
   List interactions (delegate)
   ----------------------- */
listEl.addEventListener('click', (ev)=>{
  const btn = ev.target.closest('button');
  if(!btn) return;
  const id = btn.dataset.id;
  const action = btn.dataset.action || (btn.textContent.includes('❤') ? 'like' : (btn.textContent.toLowerCase().includes('open') ? 'view' : 'pay'));
  const entry = entries.find(x=>x.id===id);
  if(!entry) return;
  if(action==='like'){ entry.likes = (entry.likes||0)+1; saveEntries(); render(); }
  else if(action==='view'){ entry.views = (entry.views||0)+1; saveEntries(); render(); }
  else if(action==='pay'){
    // open payment link or simulate
    if(PAYMENT_LINK){
      window.open(PAYMENT_LINK,'_blank');
      if(confirm('Po zaplatení stlač OK a označíme odkaz ako platený (sim.)')){ entry.paid = true; saveEntries(); render(); }
    } else {
      if(confirm('Simulovaná platba — označiť ako platené?')){ entry.paid = true; saveEntries(); render(); }
    }
  }
});

/* -----------------------
   Search / sort listeners
   ----------------------- */
searchEl.addEventListener('input', render);
sortEl.addEventListener('change', render);

/* -----------------------
   Init
   ----------------------- */
render();
</script>
</body>
</html>
