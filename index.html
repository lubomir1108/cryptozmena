<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Arch√≠v Dediƒçstva ‚Äî Elegant Gold Edition v11.0</title>
<meta name="description" content="Zanechaj vetu pre bud√∫ce gener√°cie. Arch√≠v Dediƒçstva ‚Äî pr√©miov√° kapsula ƒçasu.">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg-900:#070707;
    --bg-800:#0f0f10;
    --card:#0f1214;
    --glass: rgba(255,255,255,0.04);
    --gold: #c89b2e;
    --gold-2:#e0b230;
    --muted:#bdbdbd;
    --danger:#c95252;
    --round:14px;
    --max-width:1100px;
    --text:#f6f6f6;
    --glass-blur: 8px;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background: radial-gradient(600px 300px at 10% 10%, rgba(200,155,46,0.04), transparent),
                linear-gradient(180deg,var(--bg-900),var(--bg-800));
    color:var(--text);
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    line-height:1.45;
    padding:28px 18px 120px;
  }

  .wrap{max-width:var(--max-width);margin:0 auto;}
  header{display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap;margin-bottom:18px}
  .brand{display:flex;align-items:center;gap:14px;cursor:pointer}
  .logo{
    width:60px;height:60px;border-radius:12px;background:linear-gradient(135deg,var(--gold),var(--gold-2));
    display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--bg-900);font-family: 'Playfair Display', serif;
    font-size:20px; box-shadow:0 6px 20px rgba(200,155,46,0.12);
    transition:transform .15s ease, box-shadow .15s;
  }
  .logo:hover{transform:translateY(-3px); box-shadow:0 10px 30px rgba(200,155,46,0.18)}
  .brand-info h1{margin:0;font-family:'Playfair Display',serif;font-size:20px;font-weight:700}
  .brand-info p{margin:2px 0 0;color:var(--muted);font-size:13px}

  /* Header right controls */
  .controls{display:flex;gap:8px;align-items:center}
  .lang-btn{background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--muted);padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:600}
  .lang-btn.active{background:var(--gold);color:var(--bg-900);border-color:var(--gold)}
  .admin-indicator{font-size:12px;padding:6px 8px;border-radius:8px;background:rgba(201,76,76,0.12);color:var(--text);font-weight:700;display:inline-block}

  /* Layout */
  .hero{
    display:flex;gap:22px;align-items:center;padding:22px;border-radius:18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    border:1px solid rgba(255,255,255,0.03);backdrop-filter: blur(var(--glass-blur));box-shadow:0 8px 30px rgba(0,0,0,0.5);
  }
  .hero-left{flex:1;min-width:220px}
  .hero-title{font-family:'Playfair Display',serif;font-size:26px;margin:0;color:var(--text)}
  .hero-sub{color:var(--muted);margin-top:8px}
  .hero-cta{margin-top:14px;display:flex;gap:12px;align-items:center}

  .gold-btn{
    background:linear-gradient(90deg,var(--gold),var(--gold-2));
    color:var(--bg-900); border:0;padding:12px 18px;border-radius:12px;font-weight:800;cursor:pointer;font-size:15px;
    box-shadow:0 8px 20px rgba(200,155,46,0.12);transition:transform .12s, box-shadow .12s;
  }
  .gold-btn:hover{transform:translateY(-3px);box-shadow:0 16px 40px rgba(200,155,46,0.16)}
  .ghost-btn{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.06);padding:10px 14px;border-radius:10px;cursor:pointer}

  /* Grid */
  .grid{display:grid;grid-template-columns:1fr 360px;gap:20px;margin-top:18px}
  @media(max-width:980px){.grid{grid-template-columns:1fr;padding:0}}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 30px rgba(0,0,0,0.45)}
  .card h3{margin:0 0 8px 0;font-size:18px;font-family:'Playfair Display',serif}

  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  input[type="text"], textarea, select{
    width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);
    background: rgba(255,255,255,0.02); color:var(--text); font-size:14px;
  }
  textarea{min-height:110px;resize:vertical}
  .row{display:flex;gap:10px;align-items:center}
  .small{font-size:13px;color:var(--muted)}

  /* List */
  .list{display:flex;flex-direction:column;gap:12px;max-height:520px;overflow:auto;padding-right:6px}
  .item{
    padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.02);
    display:flex;gap:12px;align-items:flex-start;transition:transform .12s, box-shadow .12s;
  }
  .item:hover{transform:translateY(-4px);box-shadow:0 12px 30px rgba(0,0,0,0.5)}
  .avatar{width:54px;height:54px;border-radius:10px;background:rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--muted);font-size:16px}
  .meta{font-size:12px;color:var(--muted)}
  .tag-paid{background:linear-gradient(90deg,var(--gold),var(--gold-2));color:var(--bg-900);padding:6px 8px;border-radius:8px;font-weight:800;font-size:12px}
  .time-limit{background:rgba(201,76,76,0.08);color:var(--danger);padding:6px 8px;border-radius:8px;font-weight:700;font-size:12px}

  /* admin */
  .delete-btn{background:var(--danger);color:white;border:0;padding:8px 10px;border-radius:8px;cursor:pointer;font-size:13px}

  /* sticky CTA */
  .sticky-cta{
    position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border-radius:999px;padding:10px 16px;display:flex;gap:12px;align-items:center;box-shadow:0 12px 40px rgba(0,0,0,0.6);backdrop-filter: blur(var(--glass-blur));
    border:1px solid rgba(200,155,46,0.12);z-index:1200;
  }
  .cta-text{color:var(--muted);font-weight:600}
  .pulse{animation:pulse 3s infinite}
  @keyframes pulse{0%{transform:translateX(-50%) scale(1)}50%{transform:translateX(-50%) scale(1.02)}100%{transform:translateX(-50%) scale(1)}}

  footer{margin-top:28px;color:var(--muted);font-size:13px;text-align:center}

  /* utility */
  .flex-between{display:flex;justify-content:space-between;align-items:center}
  .pill{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02);font-weight:700}
  .liked{color:#ff6b6b;font-weight:800}

  /* accessibility focus */
  button:focus, a:focus, input:focus, textarea:focus{outline:2px solid rgba(200,155,46,0.18);outline-offset:2px}
</style>
</head>
<body>
<div class="wrap" id="app">
  <header>
    <div class="brand" id="brandLogo" tabindex="0" title="Otvori≈• admin pole (mobil)">
      <div class="logo">Aƒå</div>
      <div class="brand-info">
        <h1 id="title">Arch√≠v Dediƒçstva</h1>
        <p id="subtitle">Kapsula ƒåasu ‚Äî Ulo≈æte svoj hlas pre bud√∫ce gener√°cie</p>
      </div>
    </div>

    <div class="controls">
      <div id="adminIndicator" aria-hidden="true"></div>
      <div role="navigation" aria-label="Jazyk">
        <button class="lang-btn" data-lang="sk">SK</button>
        <button class="lang-btn" data-lang="en">EN</button>
      </div>
    </div>

    <input id="adminToggleInput" type="text" placeholder="Zadajte ADMIN HESLO" aria-label="Admin heslo" style="display:none;margin-left:8px;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:var(--text)">
  </header>

  <section class="hero">
    <div class="hero-left">
      <div style="display:flex;align-items:center;gap:12px">
        <div style="font-size:28px">üìú</div>
        <div>
          <div class="hero-title" id="heroTitle">Uchovanie odkazu pre veƒçnos≈•</div>
          <div class="hero-sub">Vyberte trval√© ulo≈æenie a z√≠skajte kur√°torsk√© v√Ωhody a odznak uchovania.</div>
        </div>
      </div>

      <div class="hero-cta">
        <button id="heroCTABtn" class="gold-btn">Zabezpeƒçi≈• Dediƒçstvo (1‚Ç¨)</button>
        <button id="heroSecondary" class="ghost-btn">Preƒç√≠ta≈• viac</button>
      </div>
    </div>

    <div style="width:320px">
      <div class="card">
        <h3 id="formTitle">Vytvori≈• odkaz</h3>
        <label id="labelName">Meno / Prez√Ωvka (voliteƒæn√©)</label>
        <input id="author" type="text" placeholder="Ako chcete by≈• zaznamenan√Ω?" />

        <label id="labelMessage" style="margin-top:10px">Arch√≠vny vstup <span id="charCount" class="small" style="float:right">0/300</span></label>
        <textarea id="message" maxlength="300" placeholder="Zanechajte odkaz pre bud√∫cnos≈•..."></textarea>

        <div style="margin-top:12px" id="dailyLimitInfo"></div>

        <div style="display:flex;gap:10px;margin-top:12px">
          <button id="payLinkBtn" class="gold-btn" style="flex:1">üîí Zapla≈• 1‚Ç¨ ‚Äî Trval√©</button>
          <button id="saveFree" class="ghost-btn" style="flex:1">Ulo≈æi≈• doƒçasne</button>
        </div>
        <div class="small" style="margin-top:10px;color:var(--muted)">*Doƒçasn√© vstupy zanikaj√∫ po 48 hodin√°ch.</div>
      </div>
    </div>
  </section>

  <div class="grid" style="margin-top:18px">
    <main>
      <div class="card">
        <div class="flex-between">
          <h3 id="listTitle">Arch√≠vne vstupy</h3>
          <div class="small" id="count">0 odkazov</div>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px">
          <input id="search" type="text" placeholder="Hƒæada≈•..." />
          <select id="sort" aria-label="Triedi≈•">
            <option value="paid">Dediƒçstvo (najprv)</option>
            <option value="new">Najnov≈°ie</option>
            <option value="likes">Najviac uzn√°van√©</option>
            <option value="old">Najstar≈°ie</option>
            <option value="random">N√°hodn√©</option>
          </select>
        </div>

        <div id="list" class="list" style="margin-top:14px">
          <div class="small">≈Ωiadne odkazy</div>
        </div>
      </div>

      <div class="card" style="margin-top:14px">
        <h3>FAQ ‚Äî ƒåasto kladen√© ot√°zky</h3>
        <div class="small" style="margin-top:10px">
          <strong>ƒåo znamen√° trval√© ulo≈æenie?</strong>
          <div>Trval√© ulo≈æenie (DEDIƒåSTVO) zabezpeƒç√≠, ≈æe v√°≈° odkaz nebude odstr√°nen√Ω automaticky ‚Äî bude ma≈• kur√°torsk√Ω status.</div>
          <div style="margin-top:8px"><strong>Je platba skutoƒçn√°?</strong> Demo verzia str√°nky pou≈æ√≠va simulovan√Ω platobn√Ω link. Pri nasaden√≠ zamen√≠te `PAYMENT_LINK` za re√°lny.</div>
        </div>
      </div>
    </main>

    <aside>
      <div class="card">
        <h3 id="statsTitle">Metad√°ta</h3>
        <div style="margin-top:8px" class="small">Celkom: <strong id="statTotal">0</strong></div>
        <div class="small">Trval√©: <strong id="statPaid" style="color:var(--gold)"></strong></div>
        <div class="small">Prechodn√©: <strong id="statTemporary" style="color:var(--danger)"></strong></div>
        <div class="small">U≈°etren√° hodnota: <strong id="statSavedValue" style="color:#10b981">0 ‚Ç¨</strong></div>
        <div style="margin-top:8px" class="small">ƒå√≠tan√≠: <strong id="statViews">0</strong></div>
        <div class="small">Uznan√≠: <strong id="statLikes">0</strong></div>
      </div>

      <div class="card" style="margin-top:14px">
        <h3 id="topTitle">Top</h3>
        <div id="topList" style="margin-top:10px"></div>
      </div>
    </aside>
  </div>

  <footer>¬© <span id="year"></span> Arch√≠v Dediƒçstva ‚Äî Elegant Gold Edition v11.0</footer>
</div>

<div class="sticky-cta" id="stickyCta" role="region" aria-label="Akcia">
  <div class="cta-text" id="ctaText">‚åõ V√°≈° odkaz je len doƒçasn√Ω. Zabezpeƒçte ho trvalo za <strong>1‚Ç¨</strong>!</div>
  <button id="stickyPayBtn" class="gold-btn pulse">Zabezpeƒçi≈• (1‚Ç¨)</button>
</div>

<script>
/* ---------------------------
  Konfigur√°cia a Konstanty
   --------------------------- */
const TEMP_DURATION_MS = 48 * 60 * 60 * 1000; // 48h
const DELETE_INTERVAL_MS = 60 * 60 * 1000; // check every hour
const DAILY_FREE_LIMIT = 3;
const MESSAGE_PRICE = 1.00;
const STORAGE_KEY = 'archiv_v11_entries';
const DAILY_LIMIT_KEY = 'archiv_v11_daily';
const LIKES_KEY = 'archiv_v11_likes';
const ADMIN_MODE_KEY = 'archiv_v11_admin';
const ADMIN_PASSWORD = 'ARCHIVAR';
const PAYMENT_LINK = 'https://simulacia.platba.sk/vas-odkaz-1euro'; // replace in production

// Konami (optional)
const ADMIN_TOGGLE_KEYS = ['ArrowUp','ArrowUp','ArrowDown','ArrowDown','ArrowLeft','ArrowRight','ArrowLeft','ArrowRight','b','a'];

/* ---------------------------
  Jednoduch√© i18n (sk/en)
   --------------------------- */
const I18N = {
  sk: {
    title: 'Arch√≠v Dediƒçstva',
    subtitle: 'Kapsula ƒåasu ‚Äî Ulo≈æte svoj hlas pre bud√∫ce gener√°cie',
    formTitle: 'Vytvori≈• odkaz',
    payLinkText: 'üîí Zapla≈• 1‚Ç¨ ‚Äî Trval√©',
    saveFree: 'Ulo≈æi≈• doƒçasne (48h)',
    placeholderMsg: 'Zanechajte odkaz pre bud√∫cnos≈•...',
    paidTag: 'DEDIƒåSTVO üìú',
    temporaryTag: (t)=>`Z√°nik za ${t}`,
    anonymous:'Nezn√°my',
    noResults:'≈Ωiadne vstupy v arch√≠ve',
    alertEmpty:'Vstup nem√¥≈æe by≈• pr√°zdny!',
    alertLong:'Maxim√°lne 300 znakov.',
    alertPaySim:'PLATOBN√ù LINK je simulovan√Ω. Simulova≈• platbu? (OK = √°no)',
    alertThanksPaid:'ƒéakujeme! V√°≈° vstup bol ulo≈æen√Ω trvalo.',
    alertThanksTemp:'Vstup ulo≈æen√Ω doƒçasne. Zanikne o 48 hod√≠n.',
    adminOn:'ADMIN MODE: AKT√çVNY',
    adminOff:'ADMIN MODE: DEAKT√çVNY',
    adminDeleteConfirm:'Naozaj zmaza≈• tento z√°znam?'
  },
  en: {
    title: 'Archive of Heritage',
    subtitle: 'Time Capsule ‚Äî Secure your message for future generations',
    formTitle: 'Create message',
    payLinkText: 'üîí Pay ‚Ç¨1 ‚Äî Permanent',
    saveFree: 'Save temporarily (48h)',
    placeholderMsg: 'Leave a message for the future...',
    paidTag: 'HERITAGE üìú',
    temporaryTag: (t)=>`Expires in ${t}`,
    anonymous:'Unknown',
    noResults:'No entries',
    alertEmpty:'Entry cannot be empty!',
    alertLong:'Max 300 characters.',
    alertPaySim:'Payment link is simulated. Simulate payment? (OK = yes)',
    alertThanksPaid:'Thanks! Your entry is permanently stored.',
    alertThanksTemp:'Saved temporarily. Will expire in 48 hours.',
    adminOn:'ADMIN MODE: ACTIVE',
    adminOff:'ADMIN MODE: INACTIVE',
    adminDeleteConfirm:'Permanently delete this entry?'
  }
};
let LANG = localStorage.getItem('archiv_v11_lang') || 'sk';
let isAdminMode = localStorage.getItem(ADMIN_MODE_KEY) === 'true';

/* ---------------------------
  Stav + perzistencia
   --------------------------- */
let entries = [];
let dailyState = {count:0, date:Date.now()};
let userLikes = new Set();

function now(){ return Date.now(); }
function uid(prefix='id'){ return prefix + Math.random().toString(36).slice(2,9); }

function loadEntries(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    const parsed = raw ? JSON.parse(raw) : [];
    // filter expired (non-paid)
    const filtered = parsed.filter(e => e.paid || (e.ts + TEMP_DURATION_MS > now()));
    entries = filtered;
    saveEntries();
  }catch(e){ entries = []; }
}

function saveEntries(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(entries)); }catch(e){} }

function loadDaily(){
  try{
    const raw = localStorage.getItem(DAILY_LIMIT_KEY);
    dailyState = raw ? JSON.parse(raw) : {count:0, date:now()};
    // reset daily if older than day
    if(now() - dailyState.date > 24*60*60*1000) dailyState = {count:0, date:now()};
  }catch(e){ dailyState = {count:0, date:now()}; }
}
function saveDaily(){ try{ localStorage.setItem(DAILY_LIMIT_KEY, JSON.stringify(dailyState)); }catch(e){} }
function remainingFree(){ loadDaily(); return Math.max(0, DAILY_FREE_LIMIT - (dailyState.count||0)); }
function useFreeSlot(){ loadDaily(); if(dailyState.count < DAILY_FREE_LIMIT){ dailyState.count++; dailyState.date = now(); saveDaily(); return true } return false }

function loadLikes(){ try{ const raw = localStorage.getItem(LIKES_KEY); userLikes = raw ? new Set(JSON.parse(raw)) : new Set(); }catch(e){ userLikes = new Set(); } }
function saveLikes(){ try{ localStorage.setItem(LIKES_KEY, JSON.stringify(Array.from(userLikes))); }catch(e){} }

/* ---------------------------
  DOM refs
   --------------------------- */
const el = id => document.getElementById(id);
const qs = sel => document.querySelector(sel);
const qsa = sel => Array.from(document.querySelectorAll(sel));

let refs = {};
function cacheRefs(){
  refs = {
    author: el('author'),
    message: el('message'),
    payLinkBtn: el('payLinkBtn'),
    saveFree: el('saveFree'),
    dailyLimitInfo: el('dailyLimitInfo'),
    stickyPayBtn: el('stickyPayBtn'),
    list: el('list'),
    statTotal: el('statTotal'),
    statPaid: el('statPaid'),
    statTemporary: el('statTemporary'),
    statViews: el('statViews'),
    statLikes: el('statLikes'),
    topList: el('topList'),
    count: el('count'),
    charCount: el('charCount'),
    adminIndicator: el('adminIndicator'),
    adminToggleInput: el('adminToggleInput'),
    brandLogo: el('brandLogo'),
    title: el('title'),
    subtitle: el('subtitle'),
    formTitle: el('formTitle'),
    listTitle: el('listTitle'),
    statsTitle: el('statsTitle'),
    topTitle: el('topTitle'),
    ctaText: el('ctaText'),
    year: el('year')
  };
}

/* ---------------------------
  Helpers
   --------------------------- */
function getRemainingTime(ts){
  const r = (ts + TEMP_DURATION_MS) - now();
  if(r <= 0) return null;
  const h = Math.floor(r / (1000*60*60));
  const m = Math.floor((r % (1000*60*60)) / (1000*60));
  if(h>0) return `${h}h ${m}m`;
  return `${m}m`;
}
function formatDate(ts){ return new Date(ts).toLocaleString(LANG, {year:'numeric',month:'short',day:'numeric'}); }
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])) }
function truncate(s,n){ return s.length>n ? s.slice(0,n-1)+'‚Ä¶' : s }
function avatarInitials(name){
  const nm = (name||'').trim();
  if(!nm) return 'NA';
  const parts = nm.split(' ').filter(Boolean);
  if(parts.length===1) return parts[0].slice(0,2).toUpperCase();
  return (parts[0][0]+parts[parts.length-1][0]).toUpperCase();
}
function t(key, ...args){ return I18N[LANG][key] && typeof I18N[LANG][key] === 'function' ? I18N[LANG][key](...args) : I18N[LANG][key] }

/* ---------------------------
  Render
   --------------------------- */
function render(){
  if(!refs.list) return;
  const T = I18N[LANG];
  // filter & sort
  const q = (qs('#search')?.value || '').trim().toLowerCase();
  let list = entries.slice();
  list.forEach((e,i)=> e.rank = i+1);
  if(q) list = list.filter(e => (e.text + ' ' + (e.author||'')).toLowerCase().includes(q));
  const sort = qs('#sort')?.value || 'paid';
  if(sort==='paid') list.sort((a,b)=> (b.paid?1:0)-(a.paid?1:0) || b.ts-a.ts);
  else if(sort==='new') list.sort((a,b)=>b.ts-a.ts);
  else if(sort==='old') list.sort((a,b)=>a.ts-b.ts);
  else if(sort==='likes') list.sort((a,b)=>b.likes - a.likes || b.ts - a.ts);
  else if(sort==='random') list.sort(()=>Math.random()-0.5);

  refs.list.innerHTML = '';
  if(list.length === 0){
    refs.list.innerHTML = `<div class="small">${t('noResults')}</div>`;
  } else {
    list.forEach((e)=>{
      const isTemp = !e.paid;
      const rem = isTemp ? getRemainingTime(e.ts) : null;
      const liked = userLikes.has(e.id);
      const item = document.createElement('div');
      item.className = 'item';
      item.dataset.id = e.id;
      item.innerHTML = `
        <div class="avatar" aria-hidden="true">${avatarInitials(e.author||t('anonymous'))}</div>
        <div style="flex:1">
          <div style="display:flex;align-items:center;gap:8px">
            <div style="font-weight:700">${escapeHtml(e.author||t('anonymous'))}</div>
            <div class="meta">${formatDate(e.ts)}</div>
            <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
              ${e.paid ? `<span class="tag-paid">${t('paidTag')||'DEDIƒåSTVO'}</span>` : ''}
              ${isTemp ? `<span class="time-limit">${t('temporaryTag', rem||'0m')}</span>` : ''}
            </div>
          </div>
          <div style="margin-top:8px;font-size:15px">${escapeHtml(e.text)}</div>
          <div style="margin-top:8px;display:flex;align-items:center;justify-content:space-between">
            <div class="meta">
              <span data-action="like" data-id="${e.id}" style="cursor:pointer;margin-right:12px" class="${liked ? 'liked' : ''}">‚ù§ ${e.likes||0}</span>
              <span class="meta">ƒå√≠tan√≠: ${e.views||0}</span>
              <button data-action="share" data-id="${e.id}" class="ghost-btn" style="margin-left:10px">Zdieƒæa≈•</button>
            </div>
            ${isAdminMode ? `<button data-action="delete" data-id="${e.id}" class="delete-btn">ZMAZA≈§</button>` : ''}
          </div>
        </div>
      `;
      refs.list.appendChild(item);

      // increment view on first render per entry (session)
      if(!e.viewedInSession){
        e.views = (e.views||0) + 1;
        e.viewedInSession = true;
      }
    });
    saveEntries();
  }

  // stats
  const paidCount = entries.filter(e=>e.paid).length;
  const tempCount = entries.filter(e=>!e.paid).length;
  const savedVal = (paidCount * MESSAGE_PRICE).toFixed(2);

  refs.statTotal.textContent = entries.length;
  refs.statPaid.textContent = paidCount;
  refs.statTemporary.textContent = tempCount;
  refs.statViews.textContent = entries.reduce((s,e)=>s+(e.views||0),0);
  refs.statLikes.textContent = entries.reduce((s,e)=>s+(e.likes||0),0);
  refs.statSavedValue.textContent = `${savedVal} ‚Ç¨`;
  refs.count.textContent = `${list.length} ${LANG==='sk' ? 'vstupov' : 'entries'}`;

  // top list
  const top = entries.slice().sort((a,b)=> (b.likes||0) - (a.likes||0)).slice(0,5);
  refs.topList.innerHTML = '';
  if(top.length===0) refs.topList.innerHTML = '<div class="small">‚Äî</div>';
  else top.forEach((tE,i)=>{
    const d = document.createElement('div'); d.className = 'small'; d.innerHTML = `<strong>#${i+1} ${escapeHtml(tE.author||t('anonymous'))}</strong>: ${escapeHtml(truncate(tE.text,60))} ‚Äî <span style="font-weight:700;color:var(--gold-2)">‚ù§ ${tE.likes||0}</span>`;
    refs.topList.appendChild(d);
  });

  // daily info & CTAs
  const remSlots = remainingFree();
  refs.dailyLimitInfo.innerHTML = remSlots > 0 ? `<div class="pill">üçÄ Zost√°va ${remSlots} kur√°torsk√Ωch slotov zadarmo</div>` : `<div class="pill">üö´ Dnes ≈æiadne bezplatn√© sloty</div>`;

  // admin indicator
  refs.adminIndicator.innerHTML = isAdminMode ? `<span class="admin-indicator">${t('adminOn')}</span>` : '';
}

/* ---------------------------
  Actions: Add / Payment / Free
   --------------------------- */
function addEntry({paid=false, isFree=false} = {}){
  const text = refs.message.value.trim();
  const author = refs.author.value.trim() || null;
  if(!text) return alert(t('alertEmpty'));
  if(text.length > 300) return alert(t('alertLong'));
  const entry = {
    id: uid('o_'),
    author,
    text,
    ts: now(),
    likes: 0,
    views: 0,
    paid: Boolean(paid || isFree)
  };
  entries.unshift(entry);
  saveEntries();
  refs.author.value = '';
  refs.message.value = '';
  refs.charCount.textContent = '0/300';
  // messages
  if(isFree) alert(t('alertThanksPaid') || t('alertThanksTemp'));
  else if(paid) alert(t('alertThanksPaid'));
  else alert(t('alertThanksTemp'));
  render();
}

function handlePayment(){
  if(!refs.message.value.trim()) return alert(t('alertEmpty'));
  // if PAYMENT_LINK simulated -> ask
  if(!PAYMENT_LINK || PAYMENT_LINK.includes('simulacia')){
    if(confirm(t('alertPaySim'))){
      addEntry({paid:true});
    }
    return;
  }
  // otherwise open link and confirm
  window.open(PAYMENT_LINK, '_blank');
  setTimeout(()=>{
    if(confirm('Po dokonƒçen√≠ platby stlaƒç OK pre potvrdenie platby.')) addEntry({paid:true});
  }, 1500);
}

function handleFree(){
  if(!refs.message.value.trim()) return alert(t('alertEmpty'));
  const rem = remainingFree();
  if(rem > 0){
    if(confirm(`Chcete vyu≈æi≈• jeden z ${rem} bezplatn√Ωch slotov?`)){
      useFreeSlot();
      addEntry({isFree:true});
    }
  } else {
    if(confirm('Dne≈°n√Ω bezplatn√Ω limit je vyƒçerpan√Ω. Ulo≈æi≈• len ako doƒçasn√©?')) addEntry({paid:false});
  }
}

/* ---------------------------
  Interactions: like/share/delete
   --------------------------- */
function handleListClick(e){
  const target = e.target.closest('[data-action]');
  if(!target) return;
  const action = target.dataset.action;
  const id = target.dataset.id;
  const entry = entries.find(x=>x.id===id);
  if(!entry) return;
  if(action === 'like'){
    if(userLikes.has(id)) return;
    entry.likes = (entry.likes||0) + 1;
    userLikes.add(id);
    saveLikes(); saveEntries(); render();
  } else if(action === 'share'){
    const shareText = `${I18N[LANG].title}: "${truncate(entry.text,80)}" ‚Äî ${window.location.href}`;
    if(navigator.share){
      navigator.share({title:I18N[LANG].title,text:shareText,url:window.location.href}).catch(()=>{});
    } else {
      navigator.clipboard.writeText(shareText).then(()=> alert('Odkaz skop√≠rovan√Ω do schr√°nky!'));
    }
  } else if(action === 'delete'){
    if(!isAdminMode) return;
    if(confirm(t('adminDeleteConfirm'))){
      entries = entries.filter(x=>x.id !== id);
      saveEntries(); render();
    }
  }
}

/* ---------------------------
  Admin toggles (Konami + Mobile click)
   --------------------------- */
let keyBuffer = [];
function handleKey(e){
  keyBuffer.push(e.key);
  if(keyBuffer.length > ADMIN_TOGGLE_KEYS.length) keyBuffer.shift();
  if(keyBuffer.join(',') === ADMIN_TOGGLE_KEYS.join(',')){
    keyBuffer = [];
    showAdminInput();
  }
  // enter on admin input
  if(e.target === refs.adminToggleInput && e.key === 'Enter'){
    attemptAdminToggle(refs.adminToggleInput.value.trim());
    refs.adminToggleInput.value = '';
  }
}

function showAdminInput(){
  refs.adminToggleInput.style.display = refs.adminToggleInput.style.display === 'block' ? 'none' : 'block';
  if(refs.adminToggleInput.style.display === 'block') refs.adminToggleInput.focus();
}

function attemptAdminToggle(pwd){
  if(!pwd) { refs.adminToggleInput.style.display='none'; return; }
  if(pwd === ADMIN_PASSWORD){
    isAdminMode = !isAdminMode;
    localStorage.setItem(ADMIN_MODE_KEY, isAdminMode);
    alert(isAdminMode ? t('adminOn') : t('adminOff'));
    refs.adminToggleInput.style.display = 'none';
    render();
  } else {
    alert('Neplatn√© heslo!');
  }
}

/* ---------------------------
  Language switch
   --------------------------- */
function applyLang(lang){
  if(!I18N[lang]) lang = 'sk';
  LANG = lang;
  localStorage.setItem('archiv_v11_lang', lang);
  // set texts
  refs.title.textContent = I18N[lang].title;
  refs.subtitle.textContent = I18N[lang].subtitle;
  refs.formTitle.textContent = I18N[lang].formTitle;
  refs.listTitle.textContent = I18N[lang].listTitle;
  refs.statsTitle.textContent = I18N[lang].statsTitle;
  refs.topTitle.textContent = I18N[lang].topTitle;
  refs.payLinkBtn.textContent = I18N[lang].payLinkText.replace('1‚Ç¨', LANG==='cs' ? '25 Kƒç' : '1‚Ç¨');
  refs.stickyCtaText = I18N[lang].ctaText || refs.ctaText;
  // lang buttons
  qsa('.lang-btn').forEach(b=> b.classList.toggle('active', b.dataset.lang === lang));
  render();
}

/* ---------------------------
  Init
   --------------------------- */
function init(){
  cacheRefs();
  loadEntries();
  loadDaily();
  loadLikes();

  // set year
  refs.year.textContent = new Date().getFullYear();

  // event bindings
  refs.charCount.textContent = '0/300';
  refs.message?.addEventListener('input', ()=> refs.charCount.textContent = `${refs.message.value.length}/300`);
  refs.payLinkBtn?.addEventListener('click', handlePayment);
  refs.stickyPayBtn?.addEventListener('click', handlePayment);
  refs.saveFree?.addEventListener('click', handleFree);
  refs.list?.addEventListener('click', handleListClick);
  qsa('.lang-btn').forEach(b => b.addEventListener('click', ()=> applyLang(b.dataset.lang)));

  // admin
  document.addEventListener('keydown', handleKey);
  refs.adminToggleInput?.addEventListener('keydown', handleKey);
  refs.brandLogo?.addEventListener('click', ()=> {
    // mobile click: toggle input
    showAdminInput();
  });

  // search & sort
  qs('#search')?.addEventListener('input', render);
  qs('#sort')?.addEventListener('change', render);

  // initial locale texts
  applyLang(LANG);

  // periodic cleanup (expired)
  setInterval(()=>{
    // reload and filter expired
    loadEntries();
    render();
  }, DELETE_INTERVAL_MS);

  // set landing CTA focus
  qs('#heroCTABtn')?.addEventListener('click', ()=> {
    window.scrollTo({top: document.querySelector('.card')?.offsetTop || 0, behavior:'smooth'});
    refs.message?.focus();
  });

  // enable keyboard admin toggle (enter)
  refs.brandLogo.addEventListener('keydown', (e)=> { if(e.key==='Enter') showAdminInput(); });

  render();
}
init();

</script>
</body>
</html>
